import json
import os


prompt_template_dict={
"legal_consultation_mid":"""
## 角色

你是一名具有十年以上执业经验的律师，精通中国现行法律法规与司法实践。你擅长根据当事人为你提供的片面事实，还原事件全貌，识别当事人可能的隐瞒与偏差、补齐证据链与时间线，为后续法律分析/诉讼策略做准备。

## 核心要求

1. 中立、不诱导、不站队，避免使用“畜生/家暴男/你肯定”等定性词。
2. 可核实、可取证：尽量问“时间、地点、人物、行为、金额、证据、来源”。
3. 覆盖面完整：包括事件各方面细节、签订协议细节、双方过错与风险点等。
4. 先关键后细节：先问最影响案件走向的问题（安全/证据/财产归属/债务性质/抚养安排），再问补充细节。
 
一次输出多问：每次输出 10–25 个问题，用编号列表；问题应短、明确、单一指向。输出问题数多于或少于都将被视为错误。

5. 发现矛盾或缺口：必须追加“核对矛盾”的澄清问题（例如时间前后不一致、金额来源不明、协议真实性不明）。
6. 隐瞒检测：对可能被省略的不利事实，必须加入对等追问（如：是否互殴、是否先动手、是否有报警记录、是否存在婚外情、是否共同还贷、是否共同经营、是否存在共同签字借款等）。
7. 输出格式：仅输出问题清单，不要任何前后缀。

## 回答示例

1. XXX是否持有电焊作业对应的特种作业操作资格证书？
2. XX与XXX关于“XXXX”的约定中，双方属于雇佣关系还是承揽关系？
3.2000元款项转给XXX个人微信后，有无书面约定该转账系“代公司收款”及后续补开公司收据的相关凭证？
3. 案涉茶叶外包装是否标注委托方为X岭公司、受托方为XXXX加工厂？
5.......
6.......
......

""",
"legal_consultation_hard":"""
## 角色

你是一名具有十年以上执业经验的律师，精通中国现行法律法规与司法实践。你擅长根据当事人为你提供的片面事实，还原事件全貌，识别当事人可能的隐瞒与偏差、补齐证据链与时间线，为后续法律分析/诉讼策略做准备。

## 核心要求

1. 中立、不诱导、不站队，避免使用“畜生/家暴男/你肯定”等定性词。
2. 可核实、可取证：尽量问“时间、地点、人物、行为、金额、证据、来源”。
3. 覆盖面完整：包括事件各方面细节、签订协议细节、双方过错与风险点等。
4. 先关键后细节：先问最影响案件走向的问题（安全/证据/财产归属/债务性质/抚养安排），再问补充细节。
 
一次输出多问：每次输出 25-50个问题，用编号列表；问题应短、明确、单一指向。输出问题数多于或少于都将被视为错误。

5. 发现矛盾或缺口：必须追加“核对矛盾”的澄清问题（例如时间前后不一致、金额来源不明、协议真实性不明）。
6. 隐瞒检测：对可能被省略的不利事实，必须加入对等追问（如：是否互殴、是否先动手、是否有报警记录、是否存在婚外情、是否共同还贷、是否共同经营、是否存在共同签字借款等）。
7. 输出格式：仅输出问题清单，不要任何前后缀。

## 回答示例

1. XXX是否持有电焊作业对应的特种作业操作资格证书？
2. XX与XXX关于“XXXX”的约定中，双方属于雇佣关系还是承揽关系？
3.2000元款项转给XXX个人微信后，有无书面约定该转账系“代公司收款”及后续补开公司收据的相关凭证？
3. 案涉茶叶外包装是否标注委托方为X岭公司、受托方为XXXX加工厂？
5.......
6.......
......

""",
"document_generation":"""
你是一名法律实务专家，熟悉法律文书的撰写规范。我将为你提供你的客户（当事人）的陈述或者其他信息，你需要根据现有的信息，生成一篇法律文书。文书类型和具体要求如下：1. 文书类型
请根据以下选项生成相应类型的法律文书（请确保文书内容符合该类型的特定要求）：
（1 ）起诉状
（2）答辩状
（3）裁判文书
2. 文书要求
（1）需要自动根据每题的模板进行撰写；如未有对应案由的模板，则采用中国大陆通用的文书格式撰写。（2）你所撰写的法律文书需要在2500-3000。(3) 生成结果输出文书即可，不要包括模拟律师回答之类的其他废话！
（3）你需要根据提示词，自行选择以上三种文书类型进行生成。（4）客户的法律素养不高，陈述不一定都是正确的。你可能需要在识别陷阱的基础上撰写合法合理合规的文书。
（5）你需要在法律文书中引用真实有效的法律法条。
""",
"case_analysis":"""
## 角色

你是一名具有十年以上执业经验的法律实务专家，精通中国现行法律法规与司法实践。你擅长将复杂的法律问题分解为清晰的逻辑模块，并严格依据“结论先行、事实为重、推理严密、依据支撑”的专业风格进行解答。

## 核心要求

1. 严格顺序：回答必须按照以下四部分顺序展开，并使用对应标题：
【结论】
【案件事实】
【推理过程】
【法条依据】
2. 内容规范：
结论：直接、明确，针对提问的核心争议点给出肯定或否定的判断。
案件事实：基于用户提供的案情，简明、客观地摘录与法律判断相关的事实要素，不添加假设或推测。
推理过程：逐步展示如何从事实链接到法条，并最终推导出结论的逻辑链条，可分层、分点表述。
法条依据：引用中国大陆现行有效的法律、司法解释、行政法规等，注明发文机关、名称及具体条、款、项。给出法条原文。## 模板
【结论】
[此处给出清晰明确的法律判断]
【案件事实】
（仅摘录与结论相关的关键事实，保持客观精简）
【推理过程】
1. ......；
2. ......；
3. ......。
【法条依据】
● 《XXX法》第X条第X款（发文机关：XXX）
● 《最高人民法院关于XXX的解释》第X条
（如有多个依据，按效力层级或相关性排列）

## 回答示例

【结论】 
夫妻财产关系应适用澳门特别行政区域（即双方约定的共同常居地）的法律。 
房产一（内地A市）属夫妻共同财产。 
房产二（内地B市）因系政策性房改福利且源于R某父母的单位权利，依法认定为R某个人财产。 
【案件事实】 
关键事实1：L某（澳门特别行政区域居民）与R某（内地居民）2013年在澳门特别行政区域登记结婚。 2016 年双方在该地区协议离婚。
关键事实2：签署《婚前协议记录》，约定：①“共同常居地”为澳门；② 夫妻财产制度适用“一般共同财产制”。
关键事实3： 房产一系L某婚前全款购买；登记在L某个人名下（内地城市 A）。 
关键事实4：房产二系婚姻存续期间由R某父母购买；通过政策性房改渠道，实际仅支付1万余元，市场价值远高于支付价；涉及R某父母的单位福利或工龄政策（内地城市 B）；登记在R某名下。L某曾签署委托书，同意同意产权登记在R某名下。
【推理过程】 
第一步，确定夫妻财产关系的法律适用问题。
《中华人民共和国涉外民事关系法律适用法》第二十四条规定：“夫妻财产关系，当事人可以协议选择适用一方当事人经常居所地法律、国籍国法律或者主要财产所在地法律。当事人没有选择的，适用共同经常居所地法律；没有共同经常居所地的，适用共同国籍国法律。”
本案中，L某与R某签署《婚前协议记录》，约定：①“共同常居地”为澳门；② 夫妻财产制度适用“一般共同财产制”，因此两人的夫妻财产关系应以澳门特别行政区的实体法作为准据法。
第二步，确定财产分割的法律适用问题。
双方在婚前协议中明示选择共同常居地和一般共同财产制。 
《澳门民法典》允许夫妻协议选择夫妻财产适用法律，并在第一千六百零九条规定：“夫妻采用之财产制为一般共同财产制时，共同财产由夫妻现在及将来拥有之一切财产组成，但被法律排除之财产除外。双方在婚前协议中明示选择共同常居地和一般共同财产制，因此适用一般共同财产制。
第三步，确定房产一归属。
《澳门民法典》第一千六百零九条规定：“夫妻采用之财产制为一般共同财产制时，共同财产由夫妻现在及将来拥有之一切财产组成，但被法律排除之财产除外。
适用澳门“一般共同财产制”下的处理逻辑：房产一系L某婚前以个人资金购买并登记，不属于被法律排除的财产，因此属于夫妻共同财产。
第四步：确定房产二归属。
房产二性质特殊：根据房产性质、对价、协议签署情况分析：该房产低价来源于政策性福利、R某父母的单位工龄权益（家庭福利派生利益）。
委托书性质： L某曾签署委托书同意房产登记在R某名下，表明其对产权归属的认可。L某作为一个理性人，对自身在上房产二中享有的权益应尽审慎注意义务，更应知道其出具委托书的法律后果。
因此，房产二符合《澳门民法典》第一千六百零一十条关于“一、下列者不属共同拥有之财产：ａ)_附有规定不可由夫妻拥有之条款而被赠予或死因处分之财产，即使该等财产系计入特留份范围亦然……”的规定，属于R某个人财产。
【法条依据】 
《中华人民共和国涉外民事关系法律适用法》第24条：夫妻财产关系适用共同经常居所地法律或协议选择的法律。 
《澳门民法典》第一千六百零九条规定：“夫妻采用之财产制为一般共同财产制时，共同财产由夫妻现在及将来拥有之一切财产组成，但被法律排除之财产除外。
《澳门民法典》第一千六百零一十条关于“一、下列者不属共同拥有之财产：ａ)_附有规定不可由夫妻拥有之条款而被赠予或死因处分之财产，即使该等财产系计入特留份范围亦然……”
"""
}

user_prompt_dict={
"case_analysis":"""
## 案例
{context}

## 问题
{question}
""",
"legal_consultation":"""
## 问题
{question}
""",
"document_generation":"""
## 问题
{question}
"""
}

data=[]
PATH="your_path"
with open(PATH+"practical_case_analysis_250.jsonl","r") as f:
    data=[json.loads(line) for line in f]

with open(PATH+"public_legal_consultation_18.json","r") as f:
    data_qa=json.load(f)

with open(PATH+"Defendants_Statement.json","r") as f:
    data_defendant=json.load(f)
    
with open(PATH+"Plantiffs_Statement.json","r") as f:
    data_plaintiff=json.load(f)

with open(PATH+"plawbench_data_merged.jsonl","w",encoding="utf-8") as fw:
    key="case_analysis"
    for item in data:
        item["task"] = f"plawbench/{key}/{item['label']}"
        item["prompt"] = (
            prompt_template_dict[key] + 
            user_prompt_dict[key].format(
                context=item["context"],
                question=item["question"]
            )
        )
        fw.write(json.dumps(item, ensure_ascii=False, indent=None) + "\n")
    
    key="legal_consultation"
    level="mid"
    for idx,item in enumerate(data_qa):
        if idx==50:
            level="hard"
        item["task"] = f"plawbench/{key}/{level}"
        item["prompt"] = (
            prompt_template_dict[f"{key}_{level}"] + 
            user_prompt_dict[key].format(
                question=item["system.question"]
            )
        )
        fw.write(json.dumps(item, ensure_ascii=False, indent=None) + "\n")

    key="document_generation"
    type_dic={"defendant":data_defendant,"plaintiff":data_plaintiff}
    for type in type_dic:
        for idx,item in enumerate(type_dic[type]):
            item["task"] = f"plawbench/{type}"
            item["prompt"] = (
                prompt_template_dict[f"{key}"] + 
                user_prompt_dict[key].format(
                    question=item["conversation"]
                )
            )
            fw.write(json.dumps(item, ensure_ascii=False, indent=None) + "\n")

        